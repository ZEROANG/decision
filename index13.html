<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†³ç­–å®éªŒå®¤ - ä¸“ä¸šç‰ˆ</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #00cec9;
            --accent: #fdcb6e;
            --pro: #00b894;
            --con: #ff7675;
            --bg: #f8f9fb;
            --card: #ffffff;
            --star-empty: #dfe6e9;
            --star-filled: #fdcb6e;
            --text-main: #2d3436;
            --text-muted: #b2bec3;
        }

        body { font-family: 'PingFang SC', -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: var(--text-main); }
        .app-container { width: 100%; max-width: 500px; min-height: 100vh; background: var(--card); margin: 0 auto; box-shadow: 0 0 30px rgba(0,0,0,0.05); position: relative; }
        .page { padding: 20px; box-sizing: border-box; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }

        /* ç»Ÿä¸€è¾“å…¥é¡¹å¸ƒå±€ */
        .input-box { display: flex; align-items: center; background: #f1f3f5; border-radius: 12px; padding: 4px 12px; margin-bottom: 10px; transition: 0.2s; border: 1px solid transparent; }
        .input-box:focus-within { background: white; border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .input-box input { flex: 1; border: none; background: transparent; padding: 10px 0; outline: none; font-size: 14px; color: var(--text-main); }
        .del-btn { color: #ccc; cursor: pointer; padding: 4px; font-size: 16px; transition: 0.2s; }
        .del-btn:hover { color: var(--con); }

        /* æŒ‰é’®æ ·å¼ */
        .btn { padding: 15px; border-radius: 14px; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 12px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-back { width: 36px; height: 36px; border-radius: 50%; border: none; background: #eee; cursor: pointer; font-size: 18px; margin-right: 12px; display: flex; align-items: center; justify-content: center; }

        /* æ¨¡å¼å¡ç‰‡ */
        .mode-card { padding: 24px; border-radius: 20px; margin-bottom: 16px; cursor: pointer; transition: 0.3s; border: 1px solid #f1f3f5; background: white; display: flex; justify-content: space-between; align-items: center; }
        .mode-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }

        /* äº”è§’æ˜Ÿç»„ä»¶ */
        .star-group { display: flex; gap: 4px; font-size: 26px; margin: 8px 0; }
        .star-box { position: relative; cursor: pointer; color: var(--star-empty); }
        .star-box::before { content: 'â˜…'; }
        .star-box.active { color: var(--star-filled); }
        .star-box.half::after { content: 'â˜…'; color: var(--star-filled); position: absolute; left: 0; top: 0; width: 50%; overflow: hidden; }

        /* å¸ƒå±€ä¸æ ‡é¢˜ */
        .section-label { font-size: 0.75rem; color: var(--text-muted); margin: 20px 0 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .matrix-item { background: white; padding: 16px; border-radius: 16px; margin-bottom: 15px; border: 1px solid #eee; position: relative; }

        /* å¯¼èˆªæ  */
        .navbar { position: fixed; bottom: 0; width: 100%; max-width: 500px; height: 70px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); display: flex; border-top: 1px solid #eee; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="page-home" class="page">
        <div style="text-align:center; padding:50px 0 30px;">
            <div style="font-size: 4.5rem; margin-bottom: 15px;">ğŸ§­</div>
            <h2 style="margin:0; font-weight: 800; font-size: 1.6rem;">å¸®ä½ åšå†³å®š</h2>
            <p style="color:var(--text-muted); font-size: 0.9rem; margin-top: 8px;">åšå†³å®šå¾ˆå®¹æ˜“</p>
        </div>

        <div class="mode-card" onclick="startMode('balance')">
            <div>
                <h3 style="margin:0; color:var(--secondary);">âš–ï¸ å¤©å¹³å†³ç­–</h3>
                <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">è¯¥ä¸è¯¥åšæŸäº‹ï¼Ÿåˆ©å¼Šæƒé‡åˆ†æã€‚</p>
            </div>
            <span style="color:#ddd; font-size:24px;">â€º</span>
        </div>

        <div class="mode-card" onclick="startMode('advanced')">
            <div>
                <h3 style="margin:0; color:var(--primary);">ğŸ“Š å¯¹æ¯”å†³ç­–</h3>
                <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">å¤šä¸ªé€‰é¡¹é€‰ä¼˜ï¼Ÿå¤šç»´åº¦åŠ æƒè¯„åˆ†ã€‚</p>
            </div>
            <span style="color:#ddd; font-size:24px;">â€º</span>
        </div>

        <div class="mode-card" onclick="startMode('random')">
            <div>
                <h3 style="margin:0; color:var(--accent);">ğŸ¯ éšæœºå†³ç­–</h3>
                <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">åƒä»€ä¹ˆï¼Ÿä¹°å“ªä¸ªï¼Ÿäº¤ç»™æ¦‚ç‡æ¥å†³å®šã€‚</p>
            </div>
            <span style="color:#ddd; font-size:24px;">â€º</span>
        </div>
    </div>

    <div id="page-balance" class="page hidden">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button class="btn-back" onclick="switchPage('home')">â€¹</button>
            <h3 style="margin:0">å¤©å¹³å†³ç­–</h3>
        </div>
        <div class="input-box">
            <input type="text" id="bal-title" placeholder="ç¤ºä¾‹ï¼šè¯¥ä¸è¯¥ä¹°è¿™å° iPad Proï¼Ÿ">
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div>
                <div class="section-label" style="color:var(--pro)">ğŸŸ¢ æ”¶ç›Š</div>
                <div id="pro-list"></div>
                <button onclick="addBalanceRow('pro')" style="width:100%; border:1px dashed var(--pro); background:none; color:var(--pro); padding:8px; border-radius:12px; font-size:12px; cursor:pointer;">+ å¢åŠ </button>
            </div>
            <div>
                <div class="section-label" style="color:var(--con)">ğŸ”´ ä»£ä»·</div>
                <div id="con-list"></div>
                <button onclick="addBalanceRow('con')" style="width:100%; border:1px dashed var(--con); background:none; color:var(--con); padding:8px; border-radius:12px; font-size:12px; cursor:pointer;">+ å¢åŠ </button>
            </div>
        </div>
        <div id="bal-res" class="hidden" style="margin-top:20px; padding:20px; border-radius:16px; text-align:center; font-weight:bold;"></div>
        <button class="btn btn-secondary" style="margin-top:24px;" onclick="calculateBalance()">å¼€å§‹å†³ç­–</button>
    </div>

    <div id="page-advanced" class="page hidden">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button class="btn-back" onclick="switchPage('home')">â€¹</button>
            <h3 style="margin:0">å¯¹æ¯”å†³ç­–</h3>
        </div>
        <div id="adv-setup-view">
            <div class="input-box"><input type="text" id="adv-title" placeholder="ç¤ºä¾‹ï¼šé€‰æ‹©å“ªä¸€ä¸ªå·¥ä½œ Offerï¼Ÿ"></div>
            <div class="section-label">è¯„ä»·æ ‡å‡† (æƒé‡)</div>
            <div id="crit-list"></div>
            <button class="btn" style="background:#f1f3f5; font-size:0.8rem;" onclick="addCritRow('', 50)">+ å¢åŠ æ ‡å‡† (å¦‚ï¼šè–ªèµ„æ°´å¹³)</button>
            <div class="section-label">æ¯”è¾ƒå¯¹è±¡ (è‡³å°‘2ä¸ª)</div>
            <div id="obj-list"></div>
            <button class="btn" style="background:#f1f3f5; font-size:0.8rem;" onclick="addObjRow('')">+ å¢åŠ å¯¹è±¡ (å¦‚ï¼šå…¬å¸ A)</button>
            <button class="btn btn-primary" style="margin-top:24px;" onclick="goToScoring()">å¼€å§‹å†³ç­–</button>
        </div>
        <div id="adv-scoring-view" class="hidden">
            <div id="score-matrix"></div>
            <div id="adv-res" class="hidden" style="margin-top:20px; padding:20px; border-radius:16px; border:2px solid var(--primary); text-align:center;"></div>
            <button class="btn btn-primary" style="margin-top:24px;" onclick="calculateAdvanced()">è®¡ç®—æœ€ç»ˆå¾—åˆ†</button>
            <button class="btn" style="background:none; color:var(--primary)" onclick="toggleView(false)">â€¹ è¿”å›ä¿®æ”¹é…ç½®</button>
        </div>
    </div>

    <div id="page-random" class="page hidden">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button class="btn-back" onclick="switchPage('home')">â€¹</button>
            <h3 style="margin:0">éšæœºå†³ç­–</h3>
        </div>
        <div class="input-box"><input type="text" id="ran-title" placeholder="ç¤ºä¾‹ï¼šä»Šæ™šå»å“ªå„¿åƒé¥­ï¼Ÿ"></div>
        <div class="section-label">å€™é€‰é¡¹ (è‡³å°‘2é¡¹)</div>
        <div id="ran-options"></div>
        <button class="btn" style="background:#f1f3f5;" onclick="addRanRow('')">+ æ·»åŠ é€‰é¡¹</button>
        <div id="slot-machine" class="hidden" style="height:80px; background:#2d3436; border-radius:16px; margin:24px 0; border:4px solid var(--accent); position:relative; overflow:hidden;">
            <div id="slot-track" style="position:absolute; width:100%; transition: transform 3s cubic-bezier(0.1, 0, 0.1, 1);"></div>
        </div>
        <div id="ran-res" style="text-align:center; font-size:1.6rem; font-weight:800; color:var(--primary); min-height:40px;"></div>
        <button class="btn btn-primary" style="background:var(--accent); color:#2d3436; margin-top:20px;" onclick="doRandomRoll()">å¼€å§‹å†³ç­–</button>
    </div>

    <div id="page-history" class="page hidden">
        <h3 style="margin-bottom:20px;">ğŸ•’ å†³ç­–å†å²</h3>
        <div id="hist-container"></div>
    </div>

    <div class="navbar">
        <div class="nav-item active" id="nav-home" onclick="switchPage('home')"><i>ğŸ </i><span>é¦–é¡µ</span></div>
        <div class="nav-item" id="nav-history" onclick="switchPage('history')"><i>ğŸ•’</i><span>å†å²</span></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('decision_lab_v10') || '[]');

    function switchPage(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.add('hidden'));
        document.getElementById(`page-${p}`).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        if(document.getElementById(`nav-${p}`)) document.getElementById(`nav-${p}`).classList.add('active');
        if(p === 'history') renderHistory();
    }

    // --- é€šç”¨ï¼šåˆ é™¤ä¿æŠ¤é€»è¾‘ ---
    function safeRemove(btn, listId, minCount) {
        const list = document.getElementById(listId);
        if (list.children.length > minCount) {
            btn.closest('.input-box, .matrix-item').remove();
        } else {
            alert(`å½“å‰æ¨¡å¼ä¸‹è‡³å°‘éœ€è¦ä¿ç•™ ${minCount} ä¸ªæ¡ç›®ã€‚`);
        }
    }

    // --- æ˜Ÿçº§äº¤äº’é€»è¾‘ ---
    function setStars(group, score) {
        group.setAttribute('data-score', score);
        group.querySelectorAll('.star-box').forEach((s, i) => {
            s.classList.remove('active', 'half');
            if(i + 1 <= Math.floor(score)) s.classList.add('active');
            else if(i + 1 === Math.ceil(score) && score % 1 !== 0) s.classList.add('half');
        });
    }

    function onStarTouch(e, group, val) {
        const rect = e.target.getBoundingClientRect();
        const score = (e.clientX - rect.left) < (rect.width / 2) ? val - 0.5 : val;
        setStars(group, score);
    }

    // --- é¡µé¢åˆå§‹åŒ–å…¥å£ ---
    function startMode(mode) {
        if(mode === 'balance') {
            document.getElementById('bal-title').value = "";
            document.getElementById('pro-list').innerHTML = "";
            document.getElementById('con-list').innerHTML = "";
            addBalanceRow('pro', 'æé«˜æ•ˆç‡'); addBalanceRow('con', 'ä»·æ ¼æ˜‚è´µ');
            switchPage('balance');
        } else if(mode === 'advanced') {
            document.getElementById('adv-title').value = "";
            document.getElementById('crit-list').innerHTML = "";
            document.getElementById('obj-list').innerHTML = "";
            addCritRow('è–ªèµ„å¾…é‡', 60); addObjRow('é€‰é¡¹ A'); addObjRow('é€‰é¡¹ B');
            toggleView(false);
            switchPage('advanced');
        } else {
            document.getElementById('ran-title').value = "";
            document.getElementById('ran-options').innerHTML = "";
            addRanRow('ç«é”…'); addRanRow('è¥¿é¤');
            switchPage('random');
        }
    }

    // --- 1. å¤©å¹³å†³ç­–é€»è¾‘ ---
    function addBalanceRow(type, val = '', score = 3) {
        const div = document.createElement('div');
        div.className = 'matrix-item';
        div.style.padding = '10px';
        div.innerHTML = `
            <div style="display:flex; align-items:center; margin-bottom:8px;">
                <input type="text" value="${val}" placeholder="æè¿°" style="flex:1; border:none; outline:none; font-size:12px; background:transparent;">
                <span class="del-btn" onclick="safeRemove(this, '${type}-list', 1)">âœ•</span>
            </div>
            <div class="star-group" style="font-size:20px;" data-score="${score}">
                ${[1,2,3,4,5].map(v => `<div class="star-box ${v<=3?'active':''}" onclick="onStarTouch(event, this.parentElement, ${v})"></div>`).join('')}
            </div>`;
        document.getElementById(`${type}-list`).appendChild(div);
    }

    function calculateBalance() {
        const sum = (selector) => Array.from(document.querySelectorAll(selector)).reduce((acc, el) => acc + parseFloat(el.getAttribute('data-score')), 0);
        const pScore = sum('#pro-list .star-group');
        const cScore = sum('#con-list .star-group');
        const diff = pScore - cScore;
        const res = document.getElementById('bal-res');
        res.classList.remove('hidden');
        res.style.background = diff > 0 ? '#e6fffa' : (diff < 0 ? '#fff5f5' : '#f8f9fa');
        res.innerHTML = diff > 0 ? `<div style="color:var(--pro)">ç»“è®ºï¼šå»ºè®®å»åšï¼âœ…</div><small>ä¼˜åŠ¿åˆ†ï¼š${diff.toFixed(1)}</small>` : 
                        (diff < 0 ? `<div style="color:var(--con)">ç»“è®ºï¼šä¸å»ºè®®åšï¼ğŸš«</div><small>åŠ£åŠ¿åˆ†ï¼š${Math.abs(diff).toFixed(1)}</small>` : `<div>ç»“è®ºï¼šå¹³å±€ âš–ï¸</div><small>è¯·é‡æ–°è€ƒé‡æƒé‡</small>`);
        saveToDb('balance', document.getElementById('bal-title').value || 'å¤©å¹³å†³ç­–');
    }

    // --- 2. å¯¹æ¯”å†³ç­–é€»è¾‘ ---
    function addCritRow(n, w) {
        const div = document.createElement('div');
        div.className = 'matrix-item';
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <input type="text" class="c-n" value="${n}" placeholder="æ ‡å‡†ï¼šå¦‚è–ªèµ„" style="border:none; outline:none; font-weight:bold; width:80%;">
                <span class="del-btn" onclick="safeRemove(this, 'crit-list', 1)">âœ•</span>
            </div>
            <div style="font-size:12px; display:flex; gap:10px; align-items:center;">
                æƒé‡: <input type="range" class="c-w" value="${w}" style="flex:1" oninput="this.nextElementSibling.innerText=this.value+'%'">
                <span style="width:35px">${w}%</span>
            </div>`;
        document.getElementById('crit-list').appendChild(div);
    }

    function addObjRow(n) {
        const div = document.createElement('div');
        div.className = 'input-box';
        div.innerHTML = `<input type="text" class="o-n" value="${n}" placeholder="é€‰é¡¹ï¼šå¦‚å¤§å‚Offer">
            <span class="del-btn" onclick="safeRemove(this, 'obj-list', 2)">âœ•</span>`;
        document.getElementById('obj-list').appendChild(div);
    }

    function toggleView(scoring) {
        document.getElementById('adv-setup-view').classList.toggle('hidden', scoring);
        document.getElementById('adv-scoring-view').classList.toggle('hidden', !scoring);
    }

    function goToScoring() {
        const crits = Array.from(document.querySelectorAll('.c-n')).map((el, i) => ({ n: el.value, w: document.querySelectorAll('.c-w')[i].value }));
        const objs = Array.from(document.querySelectorAll('.o-n')).map(el => el.value);
        if(objs.length < 2) return alert("è¯·è‡³å°‘æ·»åŠ 2ä¸ªå¯¹è±¡è¿›è¡Œå¯¹æ¯”");

        const matrix = document.getElementById('score-matrix');
        matrix.innerHTML = objs.map((o, oi) => `
            <div class="matrix-item">
                <h4 style="margin:0 0 12px; color:var(--primary)">${o}</h4>
                ${crits.map((c, ci) => `
                    <div style="margin-bottom:12px; font-size:13px; color:#666;">${c.n} (${c.w}%)
                        <div class="star-group" data-o="${oi}" data-c="${ci}" data-score="3">
                            ${[1,2,3,4,5].map(v => `<div class="star-box ${v<=3?'active':''}" onclick="onStarTouch(event, this.parentElement, ${v})"></div>`).join('')}
                        </div>
                    </div>`).join('')}
            </div>`).join('');
        toggleView(true);
    }

    function calculateAdvanced() {
        const crits = Array.from(document.querySelectorAll('.c-w')).map(el => parseInt(el.value));
        const objs = Array.from(document.querySelectorAll('.o-n')).map(el => el.value);
        const results = objs.map((name, oi) => {
            let total = 0;
            crits.forEach((w, ci) => {
                const s = parseFloat(document.querySelector(`[data-o="${oi}"][data-c="${ci}"]`).getAttribute('data-score'));
                total += (s * 2) * (w / 100);
            });
            return { name, score: total.toFixed(1) };
        }).sort((a,b) => b.score - a.score);

        const res = document.getElementById('adv-res');
        res.classList.remove('hidden');
        res.innerHTML = `<h3>ğŸ† é¦–é€‰æ¨èï¼š${results[0].name}</h3>` + results.map(r => `<div style="margin:4px 0;">${r.name}: ${r.score} åˆ†</div>`).join('');
        saveToDb('advanced', document.getElementById('adv-title').value || 'å¯¹æ¯”å†³ç­–');
    }

    // --- 3. éšæœºå†³ç­–é€»è¾‘ ---
    function addRanRow(v) {
        const div = document.createElement('div');
        div.className = 'input-box';
        div.innerHTML = `<input type="text" class="r-i" value="${v}" placeholder="è¾“å…¥å€™é€‰é¡¹">
            <span class="del-btn" onclick="safeRemove(this, 'ran-options', 2)">âœ•</span>`;
        document.getElementById('ran-options').appendChild(div);
    }

    function doRandomRoll() {
        const opts = Array.from(document.querySelectorAll('.r-i')).map(el => el.value).filter(v => v);
        if(opts.length < 2) return alert("è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹");
        const track = document.getElementById('slot-track');
        document.getElementById('slot-machine').classList.remove('hidden');
        track.innerHTML = Array(15).fill(opts).flat().map(o => `<div style="height:80px; line-height:80px; text-align:center; color:white; font-weight:bold;">${o}</div>`).join('');
        const winIdx = Math.floor(Math.random()*opts.length);
        track.style.transition = 'none'; track.style.transform = 'translateY(0)';
        setTimeout(() => {
            track.style.transition = 'transform 3s cubic-bezier(0.1, 0, 0.1, 1)';
            track.style.transform = `translateY(-${(opts.length * 12 + winIdx) * 80}px)`;
        }, 50);
        setTimeout(() => { document.getElementById('ran-res').innerText = `âœ¨ ç»“æœï¼š${opts[winIdx]}`; }, 3100);
        saveToDb('random', document.getElementById('ran-title').value || 'éšæœºå†³ç­–');
    }

    // --- å†å²è®°å½• ---
    function saveToDb(type, title) {
        db.unshift({ type, title, time: new Date().toLocaleString() });
        localStorage.setItem('decision_lab_v10', JSON.stringify(db.slice(0, 20)));
    }

    function renderHistory() {
        const c = document.getElementById('hist-container');
        c.innerHTML = db.length ? db.map((h, i) => `
            <div class="mode-card" style="padding:15px;" onclick="loadHistoryItem(${i})">
                <div style="flex:1">
                    <span style="font-size:10px; padding:2px 6px; border-radius:4px; color:white; background:${h.type==='balance'?'var(--secondary)':(h.type==='advanced'?'var(--primary)':'var(--accent)')}">
                        ${h.type==='balance'?'å¤©å¹³å†³ç­–':(h.type==='advanced'?'å¯¹æ¯”å†³ç­–':'éšæœºå†³ç­–')}
                    </span>
                    <div style="font-weight:bold; margin-top:5px;">${h.title}</div>
                    <div style="font-size:10px; color:#ccc; margin-top:2px;">${h.time}</div>
                </div>
                <span class="del-btn" onclick="event.stopPropagation(); db.splice(${i},1); localStorage.setItem('decision_lab_v10', JSON.stringify(db)); renderHistory();">âœ•</span>
            </div>`).join('') : '<p style="text-align:center; color:#ccc; margin-top:100px;">æš‚æ— å†å²å†³ç­–è®°å½•</p>';
    }

    function loadHistoryItem(i) {
        const h = db[i];
        if(h.type === 'balance') { switchPage('balance'); document.getElementById('bal-title').value = h.title; }
        else if(h.type === 'advanced') { switchPage('advanced'); document.getElementById('adv-title').value = h.title; }
        else { switchPage('random'); document.getElementById('ran-title').value = h.title; }
    }
</script>
</body>
</html>